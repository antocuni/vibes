<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>wasi-http-requests</title>
    <style>:root {
    --color-bg: #ffffff;
    --color-text: #24292f;
    --color-link: #0969da;
    --color-border: #d0d7de;
    --color-code-bg: #f6f8fa;
    --color-header-bg: #f6f8fa;
    --color-app-btn: #2da44e;
    --color-app-btn-hover: #218838;
}

* { box-sizing: border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Noto, Helvetica, Arial, sans-serif;
    line-height: 1.6;
    color: var(--color-text);
    background: var(--color-bg);
    margin: 0;
    padding: 0;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem 1.5rem;
}

nav {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--color-border);
    font-size: 0.9rem;
}

nav a {
    color: var(--color-link);
    text-decoration: none;
}

nav a:hover {
    text-decoration: underline;
}

article h1 { font-size: 2rem; border-bottom: 1px solid var(--color-border); padding-bottom: 0.3em; }
article h2 { font-size: 1.5rem; border-bottom: 1px solid var(--color-border); padding-bottom: 0.3em; margin-top: 1.5em; }
article h3 { font-size: 1.25rem; margin-top: 1.5em; }

a { color: var(--color-link); text-decoration: none; }
a:hover { text-decoration: underline; }

code {
    background: var(--color-code-bg);
    padding: 0.2em 0.4em;
    border-radius: 6px;
    font-size: 0.85em;
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
}

pre {
    background: var(--color-code-bg);
    padding: 1rem;
    border-radius: 6px;
    overflow-x: auto;
    line-height: 1.45;
}

pre code {
    background: none;
    padding: 0;
    border-radius: 0;
    font-size: 0.85em;
}

ul, ol { padding-left: 2em; }
li { margin: 0.25em 0; }

hr {
    border: none;
    border-top: 1px solid var(--color-border);
    margin: 2rem 0;
}

table {
    border-collapse: collapse;
    width: 100%;
}

th, td {
    border: 1px solid var(--color-border);
    padding: 0.5em 1em;
    text-align: left;
}

th {
    background: var(--color-header-bg);
}

.app-link {
    display: inline-block;
    margin: 1rem 0;
    padding: 0.6rem 1.2rem;
    background: var(--color-app-btn);
    color: #fff;
    border-radius: 6px;
    font-weight: 600;
    text-decoration: none;
    font-size: 1rem;
}

.app-link:hover {
    background: var(--color-app-btn-hover);
    text-decoration: none;
}

.project-list a {
    font-weight: 600;
}

footer {
    margin-top: 3rem;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border);
    font-size: 0.8rem;
    color: #656d76;
}
</style>
    
</head>
<body>
    <div class="container">
        <nav><a href="../">← Back to all projects</a></nav>
        <article>
<h1 id="wasi-http-requests-from-c">WASI HTTP Requests from C</h1>
<p>Working examples of making HTTP requests from C, compiled to WebAssembly (WASI), and run with wasmtime.</p>
<h2 id="what-was-explored">What was explored</h2>
<p>Can we make HTTP requests from C compiled to WASI? Specifically:
- Can libcurl be used from WASI?
- Can other C HTTP libraries work with wasmtime's socket support?
- What actually works today?</p>
<h2 id="key-findings">Key findings</h2>
<ul>
<li>
<p><strong>libcurl cannot be compiled to WASI</strong> -- wasi-libc does not yet provide POSIX socket APIs (<code>socket()</code>, <code>connect()</code>, <code>getaddrinfo()</code>). This is tracked in <a href="https://github.com/WebAssembly/wasi-libc/issues/447">wasi-libc#447</a>. No existing C networking library that uses BSD sockets can be compiled to WASI today.</p>
</li>
<li>
<p><strong>wasi:sockets exists but has no C POSIX shim</strong> -- wasmtime implements the <code>wasi:sockets</code> interfaces (TCP, UDP, DNS), but wasi-libc hasn't built the POSIX compatibility layer on top of them. You could use raw <code>wit-bindgen</code> bindings but would need to implement HTTP yourself.</p>
</li>
<li>
<p><strong>wasi:http works and is the practical solution</strong> -- The <code>wasi:http/outgoing-handler</code> interface provides HTTP-level abstractions in the WASI Component Model. Using <code>wit-bindgen</code> to generate C bindings, you can make full HTTP requests (GET, POST with body, custom headers) from C compiled to <code>wasm32-wasip2</code>.</p>
</li>
<li>
<p><strong>The wit-bindgen C API has a non-obvious convention</strong>: <code>bool</code>-returning functions return <code>true</code> (1) for success and <code>false</code> (0) for error. This is the opposite of the common C convention where 0 = success.</p>
</li>
</ul>
<h2 id="how-it-works">How it works</h2>
<p>The approach uses the <strong>WASI Component Model</strong> with <code>wasi:http@0.2.8</code>:</p>
<ol>
<li><strong>WIT files</strong> define the HTTP interfaces (<code>wasi:http/types</code>, <code>wasi:http/outgoing-handler</code>)</li>
<li><strong>wit-bindgen</strong> generates C bindings (<code>.c</code>, <code>.h</code>, <code>_component_type.o</code>)</li>
<li><strong>wasi-sdk</strong> compiles C code targeting <code>wasm32-wasip2</code></li>
<li>The <code>wasm-component-ld</code> linker (bundled in wasi-sdk) creates a WASI component</li>
<li><strong>wasmtime</strong> runs the component with <code>-S http -S inherit-network</code></li>
</ol>
<pre class="highlight"><code>WIT files ──(wit-bindgen c)──&gt; C bindings
     your_code.c + bindings ──(wasi-sdk clang)──&gt; .wasm component
                                                       │
                                    ──(wasmtime run -S http)──&gt; execution
</code></pre>

<h2 id="examples">Examples</h2>
<h3 id="http-get-http_getc">HTTP GET (<code>http_get.c</code>)</h3>
<p>Makes a GET request to <code>https://httpbin.org/get</code>, prints the status code, response headers, and body.</p>
<h3 id="http-post-http_postc">HTTP POST (<code>http_post.c</code>)</h3>
<p>Makes a POST request to <code>https://httpbin.org/post</code> with a JSON body, demonstrating how to write request headers and body.</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li><a href="https://github.com/WebAssembly/wasi-sdk">wasi-sdk</a> (v25+) -- C/C++ to WASI compiler</li>
<li><a href="https://wasmtime.dev/">wasmtime</a> (v29+) -- WebAssembly runtime</li>
<li><a href="https://github.com/bytecodealliance/wit-bindgen">wit-bindgen</a> -- generates C bindings from WIT</li>
<li><a href="https://github.com/bytecodealliance/wasm-tools">wasm-tools</a> -- WebAssembly tooling</li>
</ul>
<p>Install Rust tools:</p>
<pre class="highlight"><code class="language-bash">cargo install wit-bindgen-cli wasm-tools
</code></pre>

<h2 id="quick-start">Quick start</h2>
<pre class="highlight"><code class="language-bash"># Download wasi-sdk and WIT files
make setup

# Build both examples
make

# Run (against httpbin.org or any HTTP server)
make run-get
make run-post
</code></pre>

<h2 id="local-testing">Local testing</h2>
<p>A test script is included that starts a local HTTP server and runs both examples against it:</p>
<pre class="highlight"><code class="language-bash">./test_local.sh
</code></pre>

<h2 id="usage">Usage</h2>
<pre class="highlight"><code class="language-bash"># Run GET example
wasmtime run -S http -S inherit-network http_get.wasm

# Run POST example
wasmtime run -S http -S inherit-network http_post.wasm
</code></pre>

<p>The <code>-S http</code> flag enables the wasi:http imports, and <code>-S inherit-network</code> grants network access to the component.</p>
<h2 id="the-wasihttp-c-api-pattern">The wasi:http C API pattern</h2>
<p>The generated C API follows this pattern for making outbound requests:</p>
<pre class="highlight"><code class="language-c">#include &quot;generated/imports.h&quot;

// 1. Create headers
wasi_http_types_own_fields_t headers = wasi_http_types_constructor_fields();

// 2. Create request with headers
wasi_http_types_own_outgoing_request_t request =
    wasi_http_types_constructor_outgoing_request(headers);

// 3. Configure request (method, scheme, authority, path)
wasi_http_types_borrow_outgoing_request_t req = wasi_http_types_borrow_outgoing_request(request);
wasi_http_types_method_t method = { .tag = WASI_HTTP_TYPES_METHOD_GET };
wasi_http_types_method_outgoing_request_set_method(req, &amp;method);
// ... set scheme, authority, path

// 4. Send request
wasi_http_outgoing_handler_own_future_incoming_response_t future;
wasi_http_outgoing_handler_error_code_t err;
wasi_http_outgoing_handler_handle(request, NULL, &amp;future, &amp;err);

// 5. Block on the future, get response
// 6. Read status, headers, body from response
</code></pre>

<p>See <code>http_get.c</code> and <code>http_post.c</code> for complete working examples.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://github.com/WebAssembly/wasi-http">wasi-http specification</a> -- the HTTP interfaces in WIT</li>
<li><a href="https://github.com/WebAssembly/wasi-sdk">wasi-sdk</a> -- C/C++ to WASI toolchain</li>
<li><a href="https://github.com/bytecodealliance/wit-bindgen">wit-bindgen</a> -- binding generator</li>
<li><a href="https://component-model.bytecodealliance.org/language-support/c.html">Component Model docs</a> -- C language support</li>
<li><a href="https://github.com/WebAssembly/wasi-libc/issues/447">wasi-libc socket tracking</a> -- when POSIX sockets will work</li>
</ul>
        </article>
        <footer>
            Built automatically from project README files.
        </footer>
    </div>
</body>
</html>